# Test ?
# set -g mode-keys vi

# Focus events are broken (2.3 still)
# -----------------------------------
set -g focus-events on

# Make sure we have true colors 
# -----------------------------
set -g default-terminal "xterm-256color"
set-option -ga terminal-overrides ",xterm-256color:Tc"
# set-option -ga terminal-overrides ",xterm-256color:Tc"
# set-option -ga terminal-overrides ",st-256color:Tc"

# Make sure italic show as italic and not as half bright
# ------------------------------------------------------
set -as terminal-overrides ',xterm*:sitm=\E[3m'

# Set Prefix / Leader
# -------------------
unbind C-a
unbind C-b
set-option -g prefix C-e

# Mouse Mode
# ----------
# set -g mode-mouse on
#set -g mode-resize-pane on
#set -g mode-select-pane on
#set -g mode-select-window on
set -g mouse on
# -- fix right click paste
# setw -g mode-mouse off


# FIXES
# -----
# -- fix delay on esc key
set -sg escape-time 0

# -- if u rename a window in tmux, bahs auto title will rename it back
set-option -g allow-rename off

# -- allow some bindings like shift+arrows to work
set-option -gw xterm-keys on

# -- by default tmux will not update window numbers when u close or reorder one
set-option -g renumber-windows on

set -g history-limit 100000

# Bindings
# --------
# -- Easier way to reload tmux config
bind -n M-r source-file ~/.tmux.conf \; display "Config reloaded"

# -- Create panes ijkl (current path requires 1.9)
bind-key - split-window -v -c "#{pane_current_path}"
bind-key | split-window -h -c "#{pane_current_path}"

# -- Zoom pane 
bind -n F12 resize-pane -Z

# -- Resize panes ijkl
bind-key -r k resize-pane -U 5
bind-key -r j resize-pane -D 5
bind-key -r h resize-pane -L 5
bind-key -r l resize-pane -R 5

# -- Pane selection hjkli
bind -n M-k select-pane -U
bind -n M-j select-pane -D
bind -n M-h select-pane -L
bind -n M-l select-pane -R
bind -n M-\ select-pane -l

# -- seemless pane switching between vim & tmux
# is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?)(diff)?$"'
# bind -n M-i if-shell "$is_vim" "send-keys M-i" "select-pane -U"
# bind -n M-k if-shell "$is_vim" "send-keys M-k" "select-pane -D"
# bind -n M-j if-shell "$is_vim" "send-keys M-j" "select-pane -L"
# bind -n M-l if-shell "$is_vim" "send-keys M-l" "select-pane -R"
# bind -n M-\ if-shell "$is_vim" "send-keys M-\\" "select-pane -l"

# -- Switching windows
bind -n C-f next-window
bind -n C-s previous-window

# -- Ordering windows
bind-key -r f swap-window -t +1
bind-key -r < swap-window -t +1
bind-key -r s swap-window -t -1
bind-key -r > swap-window -t -1
bind-key N previous-window

# Vim Mode
# --------
set-window-option -g mode-keys vi

# -- vi copy mode can be improved 
# cf. https://github.com/gotbletu/shownotes/blob/master/tmux_copy_mode_vim.txt
bind-key Escape copy-mode     # enter copy mode; default [
# bind-key -t vi-copy Escape cancel   # exit copy mode; or hit q
bind-key p paste-buffer       # paste; default ]
bind-key -t vi-copy v begin-selection   # begin visual mode
bind-key -t vi-copy V select-line   # visual line
# bind-key -t vi-copy y copy-selection    # yank
# bind -t vi-copy y copy-pipe "xclip -sel clip -i" # Share clipboard to os with xclip
# bind -t vi-copy y copy-pipe 'xclip -in -selection clipboard'
bind-key -t vi-copy r rectangle-toggle    # visual block toggle

# Customize / Styling
# -------------------
# -- Change cursor in vim to distinguish between insert and command mode
# Use in conjunciton with tmux-cursors.vim
# set-option -g terminal-overrides '*88col*:colors=88,*256col*:colors=256,xterm*:XT:Ms=\E]52;%p1%s;%p2%s\007:Cc=\E]12;%p1%s\007:Cr=\E]112\007:Cs=\E]50;CursorShape=%?%p1%{3}%<%t%{0}%e%p1%{2}%-%;%d\007'

# -- tab bar on top
# set-option -g status-position top

# -- Colors
# [seebi/tmux-colors-solarized](https://github.com/seebi/tmux-colors-solarized)
# default statusbar colors
# set-option -g default-terminal screen-256color
# set-option -g status-bg colour235 #base02
# set-option -g status-fg colour136 #yellow
# set-option -g status-attr default

# -- default window title colors
set-window-option -g window-status-fg colour244 #base0
set-window-option -g window-status-bg default
#set-window-option -g window-status-attr dim

# -- active window title colors
set-window-option -g window-status-current-fg colour12
set-window-option -g window-status-current-bg default
#set-window-option -g window-status-current-attr bright

# -- message text
set-option -g message-bg colour12
set-option -g message-fg colour0

# -- pane number display
set-option -g display-panes-active-colour colour33 #blue
set-option -g display-panes-colour colour166 #orange

# -- clock
set-window-option -g clock-mode-colour colour64 #green

# -- Status Bar --
set -g status-left-length 0
set -g status-right-length 100
# set -g status-right "#{pane_current_path}                       %A %d-%B %l:%M  #S #[fg=green,bg=black]#(tmux-mem-cpu-load --colors)#[default]"
# set -g status-right "#{pane_current_path} #[fg=green,bg=default]#(ps_mem -t) #[fg=yellow,bg=default]#(cpu)#[default] %A %d-%B %l:%M"
set -g status-interval 2
set -g status-right "#{pane_current_path} #[git rev-parse --abbrev-ref HEAD] %A %d-%B %l:%M  "
# set -g status-right "#{pane_current_path} #[fg=green,bg=default]#(ps_mem -t) #[fg=green,bg=default]#(tmux-mem-cpu-load --colors 2 15)#[default] %A %d-%B %l:%M"
# set -g status-right '#[fg=green,bg=default,bright]#(tmux-mem-cpu-load 2 44) #[fg=red,dim,bg=default]#(uptime | cut -f 4-5 -d " " | cut -f 1 -d ",") #[fg=white,bg=default]%a %H:%M:%S %p#[default] #[fg=blue]%Y-%m-%d'

bind-key Space clock-mode


######################
### DESIGN CHANGES ###
######################

# panes
set -g pane-border-fg black
set -g pane-active-border-fg colour12

## Status bar design
# status line
# set -g status-utf8 on
set -g status-justify left
set -g status-bg default
set -g status-fg colour12
set -g status-interval 2


# Show pane status on the border
# set-option -g pane-border-status top
# set-option -g pane-border-format " #P: #{pane_current_command} "


###############
### PLUGINS ###
###############
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-open'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'